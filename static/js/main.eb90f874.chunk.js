(this["webpackJsonpapollo-music-share"]=this["webpackJsonpapollo-music-share"]||[]).push([[0],{113:function(e,t,n){e.exports=n(137)},137:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(16),l=n.n(i),o=n(14),u=n(167),c=n(170),s=n(171),m=n(104),d=n(172),p=Object(u.a)((function(e){return{title:{marginLeft:e.spacing(2)}}}));var g=function(){var e=p();return r.a.createElement(c.a,{position:"fixed",color:"primary"},r.a.createElement(s.a,null,r.a.createElement(d.a,null),r.a.createElement(m.a,{variant:"h6",component:"h1",className:e.title},r.a.createElement("span",{role:"img"},"\ud83d\udd25\ud83c\udfb5"))))},f=n(39),b=n.n(f),v=n(52),h=n(13),E=n(30),y=n(198),O=n(173),S=n(174),j=n(195),x=n(175),N=n(176),w=n(177),C=n(63),k=n.n(C),I=n(178),q=n(179),_=n(50),P=n.n(_),T=n(49),R=n.n(T),G=n(29),F=n(33),A=n(35);function $(){var e=Object(F.a)(["\n    mutation deleteSong($id:uuid) {\n        delete_songs(where: {id: {_eq: $id }}) {\n            returning {\n                title\n            }\n        }\n    }\n  \n"]);return $=function(){return e},e}function D(){var e=Object(F.a)(["\n    mutation addSong($title: String!, $artist: String!, $thumbnail: String!, $duration: Float!, $url: String!) {\n        insert_songs(objects: {title: $title, artist: $artist, thumbnail: $thumbnail, duration: $duration, url: $url}) {\n            affected_rows\n        }\n    }\n"]);return D=function(){return e},e}function Q(){var e=Object(F.a)(["\n    mutation addOrRemoveFromQueue($input: SongInput!) {\n        addOrRemoveFromQueue(input: $input) @client\n    }\n"]);return Q=function(){return e},e}var L=Object(A.a)(Q()),U=Object(A.a)(D()),B=Object(A.a)($()),J=Object(u.a)((function(e){return{container:{display:"flex",alignItems:"center"},urlInput:{margin:e.spacing(1)},addSongButton:{margin:e.spacing(1)},dialog:{textAlign:"center"},thumbnail:{width:"90%"}}})),M={duration:0,title:"",artist:"",thumbnail:""};var W=function(){var e=J(),t=Object(G.a)(U),n=Object(o.a)(t,2),a=n[0],i=n[1].error,l=r.a.useState(""),u=Object(o.a)(l,2),c=u[0],s=u[1],m=r.a.useState(!1),d=Object(o.a)(m,2),p=d[0],g=d[1],f=r.a.useState(!1),C=Object(o.a)(f,2),_=C[0],T=C[1],F=r.a.useState(M),A=Object(o.a)(F,2),$=A[0],D=A[1];function Q(e){var t=e.target,n=t.name,a=t.value;D((function(e){return Object(E.a)({},e,Object(h.a)({},n,a))}))}function L(){T(!1)}function B(){return(B=Object(v.a)(b.a.mark((function e(t){var n,a,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.player,!(a=n.player.player).getVideoData){e.next=6;break}r=Y(a),e.next=10;break;case 6:if(!a.getCurrentSound){e.next=10;break}return e.next=9,z(a);case 9:r=e.sent;case 10:D(Object(E.a)({},r,{url:c}));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(){return(W=Object(v.a)(b.a.mark((function e(){var t,n,r,i,l;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=$.url,n=$.thumbnail,r=$.duration,i=$.title,l=$.artist,e.next=4,a({variables:{url:t.length>0?t:null,thumbnail:n.length>0?n:null,duration:r>0?r:null,title:i.length>0?i:null,artist:l.length>0?l:null}});case 4:L(),D(M),s(""),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("ERROR ADDING SONG ",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function Y(e){var t=e.getDuration(),n=e.getVideoData(),a=n.title,r=n.video_id;return{duration:t,title:a,artist:n.author,thumbnail:"http://img.youtube.com/vi/".concat(r,"/0.jpg")}}function z(e){return new Promise((function(t,n){e.getCurrentSound((function(e){e&&(t({duration:Number(e.duration/1e3),title:e.title,artist:e.user.username,thumbnail:e.artwork_url.replace("-large","-t500x500")}),n(new Error("failed to fetch soundcloud data")),setTimeout((function(){return t("\u2026")})))}))}))}function V(e){var t,n,a,r;return(null===i||void 0===i||null===(t=i.graphQLErrors[0])||void 0===t||null===(n=t.extensions)||void 0===n?void 0:n.path.includes(e))||(null===i||void 0===i||null===(a=i.networkError)||void 0===a||null===(r=a.extensions)||void 0===r?void 0:r.path.includes(e))}r.a.useEffect((function(){var e=P.a.canPlay(c)||R.a.canPlay(c);g(e)}),[c]);var H=$.thumbnail,K=$.title,X=$.artist;return r.a.createElement("div",{className:e.container},r.a.createElement(y.a,{open:_,onClose:L,className:e.dialog},r.a.createElement(O.a,null,"Edit Song"),r.a.createElement(S.a,null,r.a.createElement("img",{className:e.thumbnail,alt:"song thumbnail",src:H}),r.a.createElement(j.a,{value:K,onChange:Q,margin:"dense",name:"title",label:"Title",fullWidth:!0,error:V("title"),helperText:V("title")&&"Fill out field"}),r.a.createElement(j.a,{value:X,onChange:Q,margin:"dense",name:"artist",label:"Artist",fullWidth:!0,error:V("artist"),helperText:V("artist")&&"Fill out field"}),r.a.createElement(j.a,{value:H,onChange:Q,margin:"dense",name:"thumbnail",label:"Thumbnail",fullWidth:!0,error:V("thumbnail"),helperText:V("thumbnail")&&"Fill out field"})),r.a.createElement(x.a,null,r.a.createElement(N.a,{onClick:L,color:"secondary"},"Cancel"),r.a.createElement(N.a,{onClick:function(){return W.apply(this,arguments)},variant:"outlined",color:"primary"},"Add Song"))),r.a.createElement(j.a,{className:e.urlInput,onChange:function(e){return s(e.target.value)},value:c,placeholder:"Add Youtube or Soundcloud URL",type:"url",fullWidth:!0,margin:"normal",InputProps:{startAdornment:r.a.createElement(w.a,{position:"start"},r.a.createElement(I.a,null))}}),r.a.createElement(N.a,{disabled:!p,className:e.addSongButton,variant:"contained",color:"primary",endIcon:r.a.createElement(q.a,null),onClick:function(){return T(!0)}},"Add"),r.a.createElement(k.a,{url:c,hidden:!0,onReady:function(e){return B.apply(this,arguments)}}))},Y=n(180),z=n(181),V=n(182),H=n(183),K=n(184),X=n(185),Z=n(186),ee=n(187),te=n(188);function ne(){var e=Object(F.a)(["\n    subscription getSongs {\n        songs(order_by: {created_at: desc}) {\n        artist\n        duration\n        id\n        thumbnail\n        title\n        url\n        }\n    }\n"]);return ne=function(){return e},e}var ae=Object(A.a)(ne());var re=Object(u.a)((function(e){return{container:{margin:e.spacing(3)},songInfoContainer:{display:"flex",alignItems:"center"},songInfo:{width:"100%",display:"flex",justifyContent:"space-between"},thumbnail:{objectFit:"cover",width:140,height:140}}}));function ie(e){var t=e.song,n=t.id,a=r.a.useContext(Se),i=a.state,l=a.dispatch,u=re(),c=Object(G.a)(L,{onCompleted:function(e){localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),s=Object(o.a)(c,1)[0],d=t.thumbnail,p=t.title,g=t.artist,f=r.a.useState(!1),h=Object(o.a)(f,2),y=h[0],O=h[1],S=Object(G.a)(B),j=Object(o.a)(S,1)[0];function x(){return(x=Object(v.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j({variables:{id:n}});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("ERROR DELETING SONG",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}return r.a.useEffect((function(){var e=i.isPlaying&&n===i.song.id;O(e)}),[n,i.song.id,i.isPlaying]),r.a.createElement(z.a,{className:u.container},r.a.createElement("div",{className:u.songInfoContainer},r.a.createElement(V.a,{image:d,className:u.thumbnail}),r.a.createElement("div",{className:u.songInfo},r.a.createElement(H.a,null,r.a.createElement(m.a,{gutterBottom:!0,variant:"h5",component:"h2"},p),r.a.createElement(m.a,{variant:"body1",component:"p",color:"textSecondary"},g)),r.a.createElement(K.a,null,r.a.createElement(X.a,{onClick:function(){l({type:"SET_SONG",payload:{song:t}}),l(i.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})},size:"small",color:"primary"},y?r.a.createElement(Z.a,null):r.a.createElement(ee.a,null)),r.a.createElement(X.a,{onClick:function(){s({variables:{input:Object(E.a)({},t,{__typename:"Song"})}})},size:"small"},r.a.createElement(q.a,null)),r.a.createElement(X.a,{onClick:function(){return x.apply(this,arguments)},size:"small"},r.a.createElement(te.a,{color:"error"}))))))}var le=function(){var e=Object(G.c)(ae),t=e.data,n=e.loading,a=e.error;return n?r.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:50}},r.a.createElement(Y.a,null)):a?r.a.createElement("div",null,"Error fetching songs"):r.a.createElement("div",null,t.songs.map((function(e){return r.a.createElement(ie,{key:e.id,song:e})})))},oe=n(189),ue=n(199);var ce=Object(u.a)({avatar:{width:44,height:44},text:{textOverflow:"ellipsis",overflow:"hidden"},container:{display:"grid",gridAutoFlow:"column",gridTemplateColumns:"50px auto 50px",gridGap:12,alignItems:"center",marginTop:10},songInfoContainer:{overflow:"hidden",whiteSpace:"nowrap"}});function se(e){var t=e.song,n=ce(),a=Object(G.a)(L,{onCompleted:function(e){localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),i=Object(o.a)(a,1)[0],l=t.thumbnail,u=t.artist,c=t.title;return r.a.createElement("div",{className:n.container},r.a.createElement(ue.a,{src:l,alt:"Song Thumbnail",className:n.avatar}),r.a.createElement("div",{className:n.songInfoContainer},r.a.createElement(m.a,{variant:"subtitle2",className:n.text},c),r.a.createElement(m.a,{variant:"body2",color:"textSecondary",className:n.text},u)),r.a.createElement(X.a,{onClick:function(){i({variables:{input:Object(E.a)({},t,{__typename:"Song"})}})}},r.a.createElement(te.a,{color:"error"})))}var me=function(e){var t=e.queue;return Object(oe.a)((function(e){return e.breakpoints.up("md")}))&&r.a.createElement("div",{style:{margin:"10px 0"}},r.a.createElement(m.a,{color:"textSecondary",variant:"button"},"QUEUE(",t.length,")"),t.map((function(e,t){return r.a.createElement(se,{key:t,song:e})})))},de=n(200),pe=n(190),ge=n(191);function fe(){var e=Object(F.a)(["\n    query getQueuedSongs {\n        queue @client {\n            id\n            duration\n            title\n            artist\n            thumbnail\n            url\n        }\n    }\n"]);return fe=function(){return e},e}var be=Object(A.a)(fe()),ve=Object(u.a)((function(e){return{container:{display:"flex",justifyContent:"space-between"},details:{display:"flex",flexDirection:"column",padding:"0px 15px"},content:{flex:"1 0 auto"},thumbnail:{width:150},controls:{display:"flex",alignItems:"center",paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},playIcon:{height:38,width:38}}}));var he=function(){var e=Object(G.b)(be).data,t=r.a.useRef(),n=r.a.useContext(Se),a=n.state,i=n.dispatch,l=r.a.useState(0),u=Object(o.a)(l,2),c=u[0],s=u[1],d=r.a.useState(!1),p=Object(o.a)(d,2),g=p[0],f=p[1],b=r.a.useState(0),v=Object(o.a)(b,2),h=v[0],E=v[1],y=r.a.useState(0),O=Object(o.a)(y,2),S=O[0],j=O[1],x=ve();return r.a.useEffect((function(){var t=e.queue.findIndex((function(e){return e.id===a.song.id}));j(t)}),[e.queue,a.song.id]),r.a.useEffect((function(){var t=e.queue[S+1];t&&c>=.99&&(s(0),i({type:"SET_SONG",payload:{song:t}}))}),[e.queue,c,i,S]),r.a.createElement(r.a.Fragment,null,a.song.artist&&r.a.createElement(z.a,{variant:"outlined",className:x.container},r.a.createElement("div",{className:x.details},r.a.createElement(H.a,{className:x.content},r.a.createElement(m.a,{variant:"h5",component:"h3"},a.song.title),r.a.createElement(m.a,{variant:"subtitle1",component:"p",color:"textSecondary"},a.song.artist)),r.a.createElement("div",{className:x.controls},r.a.createElement(X.a,{onClick:function(){var t=e.queue[S-1];t&&i({type:"SET_SONG",payload:{song:t}})}},r.a.createElement(pe.a,null)),r.a.createElement(X.a,{onClick:function(){i(a.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})}},a.isPlaying?r.a.createElement(Z.a,{className:x.playIcon}):r.a.createElement(ee.a,{className:x.playIcon})),r.a.createElement(X.a,{onClick:function(){var t=e.queue[S+1];t&&i({type:"SET_SONG",payload:{song:t}})}},r.a.createElement(ge.a,null)),r.a.createElement(m.a,{variant:"subtitle1",component:"p",color:"textSecondary"},new Date(1e3*h).toISOString().substr(11,8))),r.a.createElement(de.a,{onMouseDown:function(){f(!0)},onMouseUp:function(){f(!1),t.current.seekTo(c)},onChange:function(e,t){s(t)},value:c,type:"range",min:0,max:1,step:.01})),r.a.createElement(k.a,{ref:t,onProgress:function(e){var t=e.played,n=e.playedSeconds;g||(s(t),E(n))},url:a.song.url,playing:a.isPlaying,hidden:!0}),r.a.createElement(V.a,{className:x.thumbnail,image:a.song.thumbnail})),r.a.createElement(me,{queue:e.queue}))},Ee=n(197),ye=n(192);var Oe=function(e,t){switch(t.type){case"SET_SONG":return Object(E.a)({},e,{song:t.payload.song});case"PLAY_SONG":return Object(E.a)({},e,{isPlaying:!0});case"PAUSE_SONG":return Object(E.a)({},e,{isPlaying:!1});default:return e}},Se=r.a.createContext({song:{artist:void 0,duration:void 0,id:void 0,thumbnail:void 0,title:void 0,url:void 0},isPlaying:!1});var je=function(){var e=r.a.useContext(Se),t=r.a.useReducer(Oe,e),n=Object(o.a)(t,2),a=n[0],i=n[1],l=Object(oe.a)((function(e){return e.breakpoints.up("md")})),u=Object(oe.a)((function(e){return e.breakpoints.up("sm")}));return r.a.createElement(Se.Provider,{value:{state:a,dispatch:i}},r.a.createElement(Ee.a,{only:"xs"},r.a.createElement(g,null)),r.a.createElement(ye.a,{container:!0,spacing:3,style:{paddingLeft:"15px"}},r.a.createElement(ye.a,{style:{paddingTop:u?"80px":10},item:!0,xs:12,md:7},r.a.createElement(W,null),r.a.createElement(le,null)),r.a.createElement(ye.a,{style:l?{position:"fixed",width:"100%",right:0,top:70}:{position:"fixed",left:0,bottom:0,width:"100%"},item:!0,xs:12,md:5},r.a.createElement(he,null))))},xe=n(193),Ne=n(194),we=n(25),Ce=n(24),ke=n(28),Ie=n(101),qe=n(41);function _e(){var e=Object(F.a)(["\n        type Song {\n            id: uuid!,\n            title: String!,\n            artist: String!,\n            thumbnail: String!,\n            duration: Float!,\n            url: String!\n        }\n\n        input SongInput {\n            id: uuid!,\n            title: String!,\n            artist: String!,\n            thumbnail: String!,\n            duration: Float!,\n            url: String!\n        }\n\n        type Query {\n            queue: [Song]!\n        }\n\n        type Mutation {\n            addOrRemoveFromQueue(input: SongInput!): [Song]!\n        }\n    "]);return _e=function(){return e},e}var Pe=new ke.c({link:new Ie.a({uri:"wss://react-apollo-music-share.herokuapp.com/v1/graphql",options:{reconnect:!0}}),cache:new qe.a,typeDefs:Object(A.a)(_e()),resolvers:{Mutation:{addOrRemoveFromQueue:function(e,t,n){var a=t.input,r=n.cache,i=r.readQuery({query:be});if(i){var l=i.queue,o=l.some((function(e){return e.id===a.id}))?l.filter((function(e){return e.id!==a.id})):[].concat(Object(Ce.a)(l),[a]);return r.writeQuery({query:be,data:{queue:o}}),o}return[]}}}}),Te={queue:Boolean(localStorage.getItem("queue"))?JSON.parse(localStorage.getItem("queue")):[]};Pe.writeData({data:Te});var Re=Pe,Ge=n(102),Fe=n(71),Ae=n(70),$e=Object(Ge.a)({palette:{type:"dark",primary:Fe.a,secondary:Ae.a}});l.a.render(r.a.createElement(we.a,{client:Re},r.a.createElement(xe.a,{theme:$e},r.a.createElement(Ne.a,null),r.a.createElement(je,null))),document.getElementById("root"))}},[[113,1,2]]]);
//# sourceMappingURL=main.eb90f874.chunk.js.map